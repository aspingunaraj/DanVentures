<!-- templates/base.html -->
<!doctype html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="utf-8"/>
  <title>{% block title %}Algo Bot{% endblock %}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* subtle polish */
    .navbar-brand { letter-spacing: .3px; }
    .card { border-radius: 14px; }
    .shadow-soft { box-shadow: 0 10px 24px rgba(0,0,0,.06); }
    .badge { font-weight: 500; }
    .nav-link.active { font-weight: 600; }
    .page-header { display:flex; align-items:center; gap:.75rem }
  </style>
  {% block head_extra %}{% endblock %}
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('home') }}">Zerodha Algo Bot</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topnav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div id="topnav" class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link {% if active=='dashboard' %}active{% endif %}" href="{{ url_for('home') }}">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link {% if active=='telemetry' %}active{% endif %}" href="{{ url_for('telemetry_page') }}">Telemetry</a></li>
        <li class="nav-item"><a class="nav-link {% if active=='config' %}active{% endif %}" href="{{ url_for('config_page') }}">Config</a></li>
        <li class="nav-item"><a class="nav-link {% if active=='actions' %}active{% endif %}" href="{{ url_for('actions_page') }}">Actions</a></li>
      </ul>

      <!-- quick status pills -->
      <div class="d-flex align-items-center gap-3">
        <span class="text-white-50 small">Broker:</span>
        <span class="badge {% if connected %}bg-success{% else %}bg-secondary{% endif %}">
          {{ 'Connected' if connected else 'Not connected' }}
        </span>
        <span class="text-white-50 small">Feed:</span>
        <span class="badge {% if feed_running %}bg-success{% else %}bg-secondary{% endif %}">
          {{ 'Running' if feed_running else 'Stopped' }}
        </span>
      </div>
    </div>
  </div>
</nav>

<div class="container py-4">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-3">
        {% for cat, msg in messages %}
          <div class="alert alert-{{ 'warning' if cat=='message' else cat }} mb-2">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {% block content %}{% endblock %}
</div>

<footer class="py-4 border-top bg-white mt-5">
  <div class="container d-flex justify-content-between small text-muted">
    <div>© {{ 2025 }} Algo Bot</div>
    <div>IST times; refresh every 2s</div>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Shared helper: UTC/ISO → IST -->
<script>
function toIST(ts) {
  if (!ts) return "-";
  if (!ts.includes("T")) return ts;              // already time-like
  const d = new Date(ts); if (isNaN(d)) return ts;
  return new Intl.DateTimeFormat("en-IN", {
    hour: "2-digit", minute: "2-digit", second: "2-digit", timeZone: "Asia/Kolkata"
  }).format(d);
}
</script>

{% block scripts %}{% endblock %}
</body>
</html>

